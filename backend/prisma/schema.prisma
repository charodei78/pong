// This is your Prisma schema file,
// learn more about it in the docs https//pris.ly/d/prisma-schema

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum Role {
  User
  Admin
}

enum ChatType {
  Chat
  Channel
}

model User {
  id           Int           @id @default(autoincrement())
  name         String        @db.VarChar(32)
  email        String        @db.VarChar(128) @unique
  login        String        @db.VarChar(24) @unique
  password     String        @db.VarChar(64)
  roles        Role[]
  created_at   DateTime      @default(now())
  updated_at   DateTime      @updatedAt
  avatar       String[]
  chats        Chat[]        @relation("members")
  adminChats   Chat[]        @relation("admins")
  ownChats     Chat[]
  ChatMessages ChatMessage[]
}

model Chat {
  id         String        @id @default(uuid()) @db.Uuid
  name       String        @db.VarChar(32)
  members    User[]        @relation("members")
  admins     User[]        @relation("admins")
  owner      User          @relation(fields: [ownerId], references: [id])
  ownerId    Int
  type       ChatType
  is_private Boolean
  password   String?        @db.VarChar(64)
  messages   ChatMessage[]
}

model ChatMessage {
  id         String   @id @default(uuid()) @db.Uuid
  chat       Chat     @relation(fields: [chatId], references: [id])
  chatId     String   @db.Uuid
  created_at DateTime @default(now())
  message    String   @db.VarChar(256)
  user       User     @relation(fields: [userId], references: [id])
  userId     Int
}
